<div class="app-container">
  <!-- Sidebar Navigation -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-graduation-cap"></i>
        </div>
        <span>Digital Skilling App</span>
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-title">Main</div>
      <a href="#" class="nav-item" routerLink="/dashboard">
        <i class="fas fa-th-large"></i>
        <span>Dashboard</span>
      </a>
      <a href="#" class="nav-item" routerLink="/company-profile">
        <i class="fas fa-building"></i>
        <span>Company Profile</span>
      </a>
      <a href="#" class="nav-item" routerLink="/job-posts">
        <i class="fas fa-briefcase"></i>
        <span>Job Posts</span>
        <span class="nav-badge">12</span>
      </a>
      <a href="#" class="nav-item" routerLink="/ai-assistant">
        <i class="fas fa-robot"></i>
        <span>AI Recommendations</span>
      </a>
      <a href="#" class="nav-item" routerLink="/training">
        <i class="fas fa-chalkboard-teacher"></i>
        <span>Training Posts</span>
      </a>
      <a href="#" class="nav-item active" routerLink="/candidates">
        <i class="fas fa-users"></i>
        <span>Candidate Matches</span>
      </a>
      <a href="#" class="nav-item" routerLink="/interviews">
        <i class="fas fa-calendar-check"></i>
        <span>Interviews</span>
      </a>
    </div>

    <div class="nav-section">
      <div class="nav-title">Support</div>
      <a href="#" class="nav-item" routerLink="/settings">
        <i class="fas fa-cog"></i>
        <span>Settings</span>
      </a>
      <a href="#" class="nav-item" routerLink="/help">
        <i class="fas fa-question-circle"></i>
        <span>Help & Support</span>
      </a>
    </div>

    <div class="sidebar-footer">
      <div class="user-profile">
        <div class="profile-avatar">
          <i class="fas fa-building"></i>
        </div>
        <div class="profile-info">
          <span class="company-name">TechCorp Inc.</span>
          <span class="role">Employer</span>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header Section -->
    <div class="page-header">
      <div class="header-top">
        <div class="header-text">
          <h1 class="page-title">
            <i class="fas fa-users"></i>
            Candidate Matches
          </h1>
          <p class="page-subtext">AI-recommended candidates based on your job posting(s).</p>
        </div>
        <div class="view-toggle">
          <button 
            class="toggle-btn" 
            [class.active]="viewMode === 'grid'"
            (click)="viewMode = 'grid'">
            <i class="fas fa-th"></i>
          </button>
          <button 
            class="toggle-btn" 
            [class.active]="viewMode === 'list'"
            (click)="viewMode = 'list'">
            <i class="fas fa-list"></i>
          </button>
        </div>
      </div>

      <!-- Filter/Sort Bar -->
      <div class="filter-sort-bar">
        <div class="filter-section">
          <div class="filter-group">
            <label>Job Post</label>
            <select [(ngModel)]="selectedJob" (change)="onJobChange()" class="filter-select">
              <option [value]="job.id" *ngFor="let job of jobPosts">
                {{ job.title }} ({{ job.matchCount }} matches)
              </option>
            </select>
          </div>
          
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input 
              type="text" 
              [(ngModel)]="searchQuery" 
              (input)="applyFilters()" 
              placeholder="Search by name or skill"
              class="search-input">
          </div>
        </div>

        <div class="filter-section">
          <div class="filter-group">
            <label>Match %</label>
            <select [(ngModel)]="skillsMatchFilter" (change)="applyFilters()" class="filter-select">
              <option value="">All matches</option>
              <option value="90">90%+ match</option>
              <option value="80">80%+ match</option>
              <option value="70">70%+ match</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label>Location</label>
            <input 
              type="text" 
              [(ngModel)]="locationFilter" 
              (input)="applyFilters()" 
              placeholder="Any location"
              class="filter-input">
          </div>
          
          <div class="filter-group">
            <label>Experience</label>
            <input 
              type="text" 
              [(ngModel)]="experienceFilter" 
              (input)="applyFilters()" 
              placeholder="Experience level"
              class="filter-input">
          </div>
          
          <div class="filter-group">
            <label>Training</label>
            <input 
              type="text" 
              [(ngModel)]="trainingFilter" 
              (input)="applyFilters()" 
              placeholder="Training completed"
              class="filter-input">
          </div>
          
          <div class="filter-group">
            <label>Sort By</label>
            <select [(ngModel)]="sortBy" (change)="sortCandidates()" class="filter-select">
              <option value="bestMatch">Best Match</option>
              <option value="mostExperienced">Most Experienced</option>
              <option value="recentlyActive">Recently Active</option>
            </select>
          </div>
          
          <button class="btn btn-outline clear-btn" (click)="clearFilters()">
            <i class="fas fa-times"></i>
            Clear
          </button>
        </div>
      </div>
    </div>

    <!-- Batch Actions Toolbar -->
    <div class="batch-actions" *ngIf="showBatchActions">
      <div class="batch-info">
        <i class="fas fa-check-square"></i>
        {{ selectedCandidates.length }} candidate(s) selected
      </div>
      <div class="batch-buttons">
        <button class="btn btn-outline" (click)="shortlistSelected()">
          <i class="fas fa-heart"></i>
          Shortlist All
        </button>
        <button class="btn btn-primary" (click)="sendBulkInvites()">
          <i class="fas fa-envelope"></i>
          Send Bulk Invites
        </button>
        <button class="btn btn-secondary" (click)="clearSelection()">
          <i class="fas fa-times"></i>
          Clear Selection
        </button>
      </div>
    </div>

    <!-- Candidate Cards -->
    <div class="candidates-container" [class.list-view]="viewMode === 'list'">
      <div class="candidate-card" *ngFor="let candidate of paginatedCandidates" [class.selected]="candidate.isSelected">
        <!-- Selection Checkbox -->
        <div class="card-selection">
          <input 
            type="checkbox" 
            [checked]="candidate.isSelected" 
            (change)="toggleCandidateSelection(candidate.id)"
            class="candidate-checkbox">
        </div>

        <!-- Profile Section -->
        <div class="candidate-profile">
          <img [src]="candidate.profilePicture" [alt]="candidate.name" class="profile-image">
          <div class="profile-info">
            <h3 class="candidate-name">{{ candidate.name }}</h3>
            <p class="candidate-title">{{ candidate.title }}</p>
          </div>
        </div>

        <!-- Match Percentage Badge -->
        <div class="match-badge" [ngClass]="getMatchScoreClass(candidate.matchScore)">
          {{ candidate.matchScore }}%
        </div>

        <!-- Key Skills Section -->
        <div class="skills-section" [title]="'Full skillset: ' + candidate.skills.join(', ')">
          <label>Key Skills</label>
          <div class="skills-chips">
            <span class="skill-chip" *ngFor="let skill of candidate.skills.slice(0, 5)">
              {{ skill }}
            </span>
          </div>
        </div>

        <!-- Experience & Background -->
        <div class="experience-section">
          <label>Experience & Background</label>
          <p class="experience-text">{{ candidate.experience }}</p>
          <p class="recent-work">{{ candidate.recentWork }}</p>
        </div>

        <!-- Training Completion Badge -->
        <div class="training-section" *ngIf="candidate.certifications.length > 0">
          <div class="training-badge" *ngFor="let cert of candidate.certifications">
            <i class="fas fa-check-circle" *ngIf="cert.verified"></i>
            <i class="fas fa-clock" *ngIf="!cert.verified"></i>
            <span [class.verified]="cert.verified">
              {{ cert.verified ? 'Certified in' : 'Training in' }} {{ cert.name }}
            </span>
          </div>
        </div>

        <!-- Engagement Status -->
        <div class="engagement-status">
          <span class="status-indicator" [class.active]="candidate.lastActive.includes('minutes') || candidate.lastActive.includes('hour')">
            <i class="fas fa-circle"></i>
            Active {{ candidate.lastActive }}
          </span>
        </div>

        <!-- Actions -->
        <div class="card-actions">
          <button class="btn btn-outline" (click)="viewFullProfile(candidate.id)">
            <i class="fas fa-eye"></i>
            View Profile
          </button>
          <button 
            class="btn" 
            [class.btn-secondary]="candidate.isShortlisted"
            [class.btn-outline]="!candidate.isShortlisted"
            (click)="toggleShortlist(candidate)">
            <i class="fas" [class.fa-heart]="candidate.isShortlisted" [class.fa-heart-o]="!candidate.isShortlisted"></i>
            {{ candidate.isShortlisted ? 'Shortlisted' : 'Shortlist' }}
          </button>
          <button class="btn btn-primary" (click)="inviteToApply(candidate.id)">
            <i class="fas fa-paper-plane"></i>
            Invite
          </button>
          <button class="btn btn-success" (click)="startChat(candidate.id)">
            <i class="fas fa-comment"></i>
            Chat
          </button>
        </div>

        <!-- AI Insights Hover -->
        <div class="ai-insights-trigger" 
             (mouseenter)="showAIInsights(candidate)" 
             (mouseleave)="hideAIInsights()">
          <i class="fas fa-robot"></i>
          <span>AI Insights</span>
        </div>
      </div>
    </div>

    <!-- Comparison View -->
    <div class="comparison-section" *ngIf="selectedCandidates.length >= 2 && selectedCandidates.length <= 3">
      <div class="comparison-header">
        <h3>
          <i class="fas fa-balance-scale"></i>
          Compare Selected Candidates
        </h3>
        <button class="btn btn-primary" (click)="showComparison = true">
          <i class="fas fa-eye"></i>
          View Comparison
        </button>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <div class="pagination-info">
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} - 
        {{ Math.min(currentPage * itemsPerPage, filteredCandidates.length) }} 
        of {{ filteredCandidates.length }} candidates
      </div>
      <div class="pagination-controls">
        <button 
          class="btn btn-outline" 
          (click)="changePage(currentPage - 1)" 
          [disabled]="currentPage === 1">
          <i class="fas fa-chevron-left"></i>
          Previous
        </button>
        <span class="page-numbers">
          <button 
            class="page-btn" 
            *ngFor="let page of [].constructor(totalPages); let i = index"
            [class.active]="i + 1 === currentPage"
            (click)="changePage(i + 1)">
            {{ i + 1 }}
          </button>
        </span>
        <button 
          class="btn btn-outline" 
          (click)="changePage(currentPage + 1)" 
          [disabled]="currentPage === totalPages">
          Next
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </main>

  <!-- Right Sidebar - AI Insights & Chat -->
  <aside class="right-sidebar">
    <!-- AI Insights Widget -->
    <div class="ai-insights-widget" *ngIf="currentInsight">
      <div class="widget-header">
        <h4>
          <i class="fas fa-robot"></i>
          AI Insights
        </h4>
      </div>
      <div class="insights-content">
        <div class="insight-item">
          <strong>Why Recommended:</strong>
          <p>{{ currentInsight.reason }}</p>
        </div>
        <div class="insight-item">
          <strong>Skill Overlap:</strong>
          <div class="skill-tags">
            <span class="skill-tag" *ngFor="let skill of currentInsight.skillOverlap">{{ skill }}</span>
          </div>
        </div>
        <div class="insight-item">
          <strong>Experience Relevance:</strong>
          <p>{{ currentInsight.experienceRelevance }}</p>
        </div>
        <div class="insight-item">
          <strong>Training Match:</strong>
          <p>{{ currentInsight.trainingMatch }}</p>
        </div>
      </div>
    </div>

    <!-- Chatbot Assistant -->
    <div class="chatbot-widget" [class.expanded]="isChatOpen">
      <div class="chat-header" (click)="toggleChat()">
        <div class="chat-title">
          <i class="fas fa-robot"></i>
          AI Assistant
        </div>
        <i class="fas" [class.fa-chevron-up]="isChatOpen" [class.fa-chevron-down]="!isChatOpen"></i>
      </div>
      
      <div class="chat-content" *ngIf="isChatOpen">
        <div class="chat-messages">
          <div 
            class="chat-message" 
            *ngFor="let message of chatMessages"
            [class.user]="message.type === 'user'"
            [class.ai]="message.type === 'ai'">
            <div class="message-content">{{ message.content }}</div>
          </div>
        </div>
        
        <div class="chat-input">
          <input 
            type="text" 
            [(ngModel)]="currentMessage" 
            (keyup.enter)="sendMessage()"
            placeholder="Ask about candidates..."
            class="message-input">
          <button class="send-btn" (click)="sendMessage()" [disabled]="!currentMessage.trim()">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions-widget">
      <div class="widget-header">
        <h4>
          <i class="fas fa-bolt"></i>
          Quick Actions
        </h4>
      </div>
      <div class="quick-buttons">
        <button class="quick-btn" (click)="selectAllVisible()">
          <i class="fas fa-check-square"></i>
          Select All Visible
        </button>
        <button class="quick-btn" (click)="clearSelection()" *ngIf="selectedCandidates.length > 0">
          <i class="fas fa-times"></i>
          Clear Selection
        </button>
        <button class="quick-btn" (click)="applyFilters()">
          <i class="fas fa-filter"></i>
          Refresh Filters
        </button>
      </div>
    </div>
  </aside>
</div>

<!-- Comparison Modal -->
<div class="modal-overlay" *ngIf="showComparison" (click)="closeComparison()">
  <div class="comparison-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <i class="fas fa-balance-scale"></i>
        Candidate Comparison
      </h3>
      <button class="close-modal" (click)="closeComparison()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="comparison-content">
      <div class="comparison-grid">
        <div class="comparison-item" *ngFor="let candidateId of selectedCandidates.slice(0, 3)">
          <ng-container *ngFor="let candidate of candidates">
            <div *ngIf="candidate.id === candidateId">
              <div class="candidate-header">
                <img [src]="candidate.profilePicture" [alt]="candidate.name" class="profile-picture">
                <div>
                  <h4>{{ candidate.name }}</h4>
                  <p class="candidate-title">{{ candidate.title }}</p>
                  <div class="match-score-badge" [ngClass]="getMatchScoreClass(candidate.matchScore)">
                    {{ candidate.matchScore }}% Match
                  </div>
                </div>
              </div>
              
              <div class="comparison-details">
                <div class="detail-section">
                  <strong>Skills</strong>
                  <div class="skills-container">
                    <span class="skill-badge" *ngFor="let skill of candidate.skills">{{ skill }}</span>
                  </div>
                </div>
                
                <div class="detail-section">
                  <strong>Certifications</strong>
                  <div class="certifications-list">
                    <div *ngFor="let cert of candidate.certifications" class="cert-item">
                      {{ cert.name }}
                      <i class="fas fa-check-circle verified-icon" *ngIf="cert.verified"></i>
                    </div>
                  </div>
                </div>
                
                <div class="detail-section">
                  <strong>Experience</strong>
                  <p>{{ candidate.experience }}</p>
                  <p class="recent-work">{{ candidate.recentWork }}</p>
                </div>
                
                <div class="detail-section">
                  <strong>Location & Availability</strong>
                  <p>{{ candidate.location }}</p>
                  <p class="availability">{{ candidate.availability }}</p>
                </div>
                
                <div class="detail-section">
                  <strong>Activity Status</strong>
                  <p class="last-active">Active {{ candidate.lastActive }}</p>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>